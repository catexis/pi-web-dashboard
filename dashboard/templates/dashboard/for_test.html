{% extends "dashboard/base.html" %}
{% load staticfiles %}

{% block content %}

<div class="content mt-3">
    <div class="animated fadeIn">
        <div class="row">
            
            <!-- Размещать контент тут -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <strong class="card-title">Card with switch</strong>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            <div class="test">0</div>
                        </p>
                    </div>
                </div>
            </div>
                        
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <strong class="card-title">Card with switch</strong>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Ram used</th>
                                    <th scope="col">Ram Free</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="r_used">000.0</td>
                                    <td class="r_free">000.0</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <strong class="card-title">Card with switch</strong>
                    </div>
                    <div class="card-body">
                        <canvas id="canvas"></canvas>
                    </div>
                </div>
            </div>

        </div><!-- .row -->
    </div><!-- .animated -->
</div><!-- .content -->

{% endblock %}

{% block js %}
    <script src="{% static 'assets/js/jquery-3.3.1.min.js' %}"></script>

    <!--  Chart js -->
    <script src="{% static 'assets\js\chartjs.min.js' %}"></script>
    <script>

        $(document).ready(function(){  // При загрузке документа
            
            // ChartJS line
            var ctx = document.getElementById('canvas').getContext('2d');
            var cptLineChart = new Chart(ctx,{
                type: 'line',
                data: {
                    labels: ["0"],
                    datasets: [{
                        label: "Температура ЦП",
                        backgroundColor: 'transparent',
                        borderColor: 'rgba(220,53,69,0.75)',
                        data: [0],
                        pointStyle: 'circle',
                        pointRadius: 5,
                        pointBackgroundColor: 'rgba(220,53,69,0.75)',
                        }],
                },
                options: {
                    responsive: true,
                    tooltips: {
                        mode: 'index',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Time'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Temperature'
                            }
                        }]
                    }
                }
            });


            // Интервальная функция
            var count = 0;
            setInterval(function(){  // Запускам периодически исполняемую функцию
                
                // Тело функции, которая буде периодически повторяться
                var $block_test = $(".test").text(count);
                count++;

                $.getJSON('index/data', function(data){
                    $(".r_used").text(data.used_ram);
                    $(".r_free").text(data.free_ram);
                    // Производим обновление данных chartJS
                    // Само обновление заключается в модернизации массива                    
                    if(cptLineChart.data.labels.length > 25){
                        cptLineChart.data.labels.splice(0,1);
                        cptLineChart.data.datasets[0].data.splice(0,1);
                    }
                    cptLineChart.data.labels.push(count);
                    cptLineChart.data.datasets[0].data.push(data.free_ram);
                    cptLineChart.update();
                });

            }, 1000);  // Интервал


        });

    </script>
{% endblock %}